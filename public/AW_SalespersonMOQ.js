function runAction(e){const{data:{record:o,related:{Account:[f],Product2:y,OrderItem:u,aforza__Outlet_Asset__c:l}},data:r}=e;if(o.Type!=="Product Order"&&f.RecordTypeId!=="0123L000000RoylQAC")return e;let d=!1;const i=new Set(u.map(t=>t.Product2Id)),a=new Map;if(y.forEach(t=>{i.has(t.Id)&&!new Set(["Tax","Promotion","Discount"]).has(t.Name)&&a.set(t.Id,t)}),!a.size)return e;const s=new Map,_=new Array;l.forEach(t=>{t.aforza__Account__c===o.AccountId&&i.has(t.aforza__Product__c)&&s.set(t.aforza__Product__c,t)}),u.forEach(I),d&&(r.updateDeviceData={OrderItem:!0},r.reprice=!0,e.data.message=`The quantities of some products have been adjusted to comply with yearly limits.

`,_.forEach(h));function I(t){const m=a.get(t.Product2Id),c=s.get(t.Product2Id),n=c.AW_FA_Yearly_Limit__c-c.AW_Yearly_Quantity__c;if(n>=t.Quantity)return;const A=t.Quantity;t.Quantity=n<=0?0:n,c.AW_Yearly_Quantity__c+=t.Quantity,_.push({Name:m.Name,Difference:t.Quantity-A}),d=!0}function h(t){r.message+=`{u2713} ${t.Name} ${t.Difference}`}return e}
