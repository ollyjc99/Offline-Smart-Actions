function runAction(o){const{data:{record:d,related:{Account:[c],Product2:g,OrderItem:m,aforza__Outlet_Asset__c:Q}},data:_}=o,p="0122z000002QGJyAAO",f="0123L000000RQhQQAW",y="0122z000002dp2PAAQ";if(!new Set(["Product Order","Sample Order"]).has(d.Type)&&!new Set([p,f,y]).has(c.RecordTypeId)&&!new Set(["DE","AT","CH"]).has(c.AW_Country__c))return o;const l=[],I=new Set(m.map(t=>t.Product2Id)),a=new Map;g.forEach(t=>{I.has(t.Id)&&!new Set(["Tax","Promotion","Discount"]).has(t.Name)&&a.set(t.Id,t)});const h=m.filter(t=>a.has(t.Product2Id)),s=P(h);s.get("Product").length&&s.get("Product").forEach(t=>{R(t)}),s.get("Outlet Asset").length&&O(s.get("Outlet Asset")),l.length?(_.message=`Some Quantities Have Been Adjusted To Comply With Limits:
`,l.forEach(t=>{_.message+=`
 * ${t.Name}: ${t.Difference}`})):_.message="Quantities Valid";function P(t){let r=new Map([["Product",[]],["Outlet Asset",[]]]);return t.forEach(e=>{let n=a.get(e.Product2Id);d.Type=="Product Order"&&c.RecordTypeId==p&&r.get("Product").push(e),(d.Type=="Sample Order"&&c.RecordTypeId==f&&n.AW_Is_Restricted_Drug__c||d.Type=="Product Order"&&c.RecordTypeId==y)&&r.get("Outlet Asset").push(e)}),r}function O(t){const r=new Map;t.forEach(e=>{let n=d.AccountId+"-"+e.Product2Id;r.has(n)?r.get(n).push(e):r.set(n,[e])}),Q.forEach(e=>{const n=e.aforza__Account__c+"-"+e.aforza__Product__c;if(!r.has(n))return;const i=r.get(n),u=T(e,c.AW_Country__c);i.forEach(D=>{W(e,D,u)})})}function T(t,r){let e,n=a.get(t.aforza__Product__c);return c.RecordTypeId==f?e=n["AW_Doctor_Limit_"+r+"__c"]:c.RecordTypeId==y&&(e=n.AW_FA_Yearly_Limit__c),e}function W(t,r,e){let n=t.AW_Yearly_Quantity__c!=null?t.AW_Yearly_Quantity__c:0,i=e-n,u=r.Quantity;r.Quantity=u+n<e?u:i>0?i:0,t.AW_Yearly_Quantity__c+=r.Quantity,u!=r.Quantity&&A(u,r)}function R(t){let r=a.get(t.Product2Id).DRWO_Minimum_Quantity__c,e=a.get(t.Product2Id).DRWO_Maximum_Quantity__c,n=t.Quantity;t.Quantity=n<r?r:n>e?e:n,n!=t.Quantity&&A(n,t)}function A(t,r){let e=r.Quantity-t;l.push({Name:a.get(r.Product2Id).Name,Difference:e<0?e:"+"+e})}return o}
