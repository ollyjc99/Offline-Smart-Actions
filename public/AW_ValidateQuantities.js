function runAction(o){const{data:{record:d,related:{Account:[c],Product2:A,OrderItem:p,aforza__Outlet_Asset__c:I}},data:_}=o,m="0122z000002QGJyAAO",f="0123L000000RQhQQAW",y="0122z000002dp2PAAQ";if(!new Set(["Product Order","Sample Order"]).has(d.Type)&&!new Set([m,f,y]).has(c.RecordTypeId)&&!new Set(["DE","AT","CH"]).has(c.AW_Country__c))return o;const l=[],Q=new Set(p.map(t=>t.Product2Id)),u=new Map;A.forEach(t=>{Q.has(t.Id)&&!new Set(["Tax","Promotion","Discount"]).has(t.Name)&&u.set(t.Id,t)});const h=p.filter(t=>u.has(t.Product2Id)),s=P(h);s.get("Product").length&&s.get("Product").forEach(t=>{w(t)}),s.get("Outlet Asset").length&&O(s.get("Outlet Asset")),l.length?(_.message=`Einige Mengen wurden angepasst, um die Grenzwerte einzuhalten:
`,l.forEach(t=>{_.message+=`
 \u2022 ${t.Name}: ${t.Difference}`})):_.message="Mengen best{u00E4}tigt {u2713}";function P(t){let r=new Map([["Product",[]],["Outlet Asset",[]]]);return t.forEach(e=>{let n=u.get(e.Product2Id);d.Type=="Product Order"&&c.RecordTypeId==m&&r.get("Product").push(e),(d.Type=="Sample Order"&&c.RecordTypeId==f&&n.AW_Is_Restricted_Drug__c||d.Type=="Product Order"&&c.RecordTypeId==y)&&r.get("Outlet Asset").push(e)}),r}function O(t){const r=new Map;t.forEach(e=>{let n=d.AccountId+"-"+e.Product2Id;r.has(n)?r.get(n).push(e):r.set(n,[e])}),I.forEach(e=>{const n=e.aforza__Account__c+"-"+e.aforza__Product__c;if(!r.has(n))return;const i=r.get(n),a=T(e,c.AW_Country__c);i.forEach(z=>{W(e,z,a)})})}function T(t,r){let e,n=u.get(t.aforza__Product__c);return c.RecordTypeId==f?e=n["AW_Doctor_Limit_"+r+"__c"]:c.RecordTypeId==y&&(e=n.AW_FA_Yearly_Limit__c),e}function W(t,r,e){let n=t.AW_Yearly_Quantity__c!=null?t.AW_Yearly_Quantity__c:0,i=e-n,a=r.Quantity;r.Quantity=a+n<e?a:i>0?i:0,t.AW_Yearly_Quantity__c+=r.Quantity,a!=r.Quantity&&g(a,r)}function w(t){let r=u.get(t.Product2Id).DRWO_Minimum_Quantity__c,e=u.get(t.Product2Id).DRWO_Maximum_Quantity__c,n=t.Quantity;t.Quantity=n<r?r:n>e?e:n,n!=t.Quantity&&g(n,t)}function g(t,r){let e=r.Quantity-t;l.push({Name:u.get(r.Product2Id).Name,Difference:e<0?e:"+"+e})}return o}
