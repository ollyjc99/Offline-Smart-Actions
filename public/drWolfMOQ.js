function runAction(i){const{data:{record:{Type:f},related:{Product2:l,OrderItem:o,Account:[n]},record:d},data:t}=i;let _=new Set,a=new Map,u=new Array,s=new Array;f=="Product Order"&&(n.RecordTypeId==="TBD"||n.RecordTypeId==="TBD"||n.RecordTypeId==="0123L000000RQhRQAW"||n.RecordTypeId==="0123L000000RQhQQAW")&&(o.forEach(e=>{_.add(e.Product2Id)}),l.forEach(e=>{_.has(e.Id)&&a.set(e.Id,e)}),a.size&&o.forEach(m),u.length||s.length?(t.error="",D(u,s),t.blockExecution=!0):(t.message="Order validated {u2713}",t.updateDeviceData=!0,t.reprice=!0,t.blockExecution=!1));function m(e){if(!new Set(["Tax","Promotion","Discount"]).has(e.aforza__Type__c)){let r=a.get(e.Product2Id),c={Id:r.Id,Name:r.Name,Difference:null};r.DRWO_Minimum_Quantity__c!=null&&r.DRWO_Minimum_Quantity__c!=0&&r.DRWO_Minimum_Quantity__c>e.Quantity&&(c.Difference=e.Quantity-r.DRWO_Minimum_Quantity__c,u.push(c)),r.DRWO_Maximum_Quantity__c!=null&&r.DRWO_Maximum_Quantity__c!=0&&r.DRWO_Maximum_Quantity__c<e.Quantity&&(c.Difference=`+${e.Quantity-r.DRWO_Maximum_Quantity__c}`,s.push(c))}}function y(e){t.error+=`\u2717 ${e.Name} ${e.Difference}`}function D(e,r){if(e.length&&(t.error+="Die folgenden Produkte liegen unter der Mindestmenge:",e.forEach(y)),r.length){let c="";t.error.length>0&&(c=`

`),t.error+=`${c}Die folgenden Produkte \xC3\xBCberschreiten die H\xC3\xB6chstmenge:`,r.forEach(y)}}return i}function processOrder(i){const{record:f,related:{Account:[l],aforza__Outlet_Asset__c:[o]}}=i.data;if(f.Type!=="Muster")return i;let n;if(l.AW_Country==="DE")n=o.AW_Doctor_DE;else if(l.AW_Country==="AT")n=o.AW_Doctor_AT;else return i;let d=o.AW_Yearly_Quantity,t=!1;for(let _ of f.OrderItem){let a=_.Quantity;if(d+a>n){let u=n-d;u<0&&(u=0),_.Quantity=u,d+=u,t=!0}else d+=a}return t&&(i.data.message="The quantities of some products have been adjusted to comply with yearly limits."),i}
