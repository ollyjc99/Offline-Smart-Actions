function runAction(T){const{data:{record:{Pricebook2Id:v},record:d,related:{Account:[W],OrderItem:t,Product2:k,PricebookEntry:p,aforza__Inventory__c:[B]}},data:i}=T;let D,P,n,A,_,u;const E={"2023-09-03":["Warehouse - Algoz"],"2023-09-07":["Warehouse - Faro"],"2023-08-15":["Warehouse - Leiria","Warehouse - Alcains","Warehouse - Coimbra","Warehouse - Beja","Warehouse - Gr\xE2ndola","Warehouse - Set\xFAbal","Warehouse - Portalegre","Warehouse - Porto","Warehouse - Odemira","Warehouse - Bombarral","Warehouse - Camarate"],"2023-12-25":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"],"2023-12-08":["Warehouse - Alcains","Warehouse - Faro","Warehouse - Algoz","Warehouse - Bombarral","Warehouse - Set\xFAbal","Warehouse - Beja","Warehouse - Gr\xE2ndola","Warehouse - Coimbra","Warehouse - Porto","Warehouse - Odemira","Warehouse - \xC9vora","Warehouse - Portalegre","Warehouse - Leiria"],"2023-12-01":["Warehouse - Alcains","Warehouse - Faro","Warehouse - Algoz","Warehouse - Bombarral","Warehouse - Set\xFAbal","Warehouse - Beja","Warehouse - Gr\xE2ndola","Warehouse - Coimbra","Warehouse - Porto","Warehouse - Odemira","Warehouse - \xC9vora","Warehouse - Portalegre","Warehouse - Leiria"]};let S=0,c={orderChanged:!1,reprice:!1},h=W.Customer_Segment__c;(!h||h=="99")&&(h="06"),k.forEach(z),p.forEach(L),D&&!P&&(P=0),A&&!_&&(_=0),t.forEach(w);let a,s,r,b=!1,C=d.EndDate,f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=W.Delivery_Day__c.split(";");if(C)a=new Date(C),r=f[a.getDay()],(I(a)||["Saturday","Sunday"].includes(r))&&(b=!0);else{for(a=m(new Date),r=f[a.getDay()],s=I(a)||!g.includes(r),s&&g.includes(r)&&(a=m(a),r=f[a.getDay()],s=!1);s;)a=m(a),r=f[a.getDay()],s=I(a)||!g.includes(r),s&&g.includes(r)&&(a=m(a),r=f[a.getDay()],s=!1);d.EndDate=a.toISOString().substring(0,10),c.orderChanged=!0}if(!new Set(["YDEV","YBLC","YDL1"]).has(d.Type)&&d.Type!="YESL"&&!["PT16","PT17","PT25"].includes(W.Typology__c)){var x=g.includes(r)||["PT16","PT17","PT25"].includes(W.Typology__c);x?(d.Shipping_Conditions__c="ZA",l(u),S>=P?(i.message="A cesta excede o limite de entrega padr\xE3o, sem custo",l(n)):(i.message="A cesta n\xE3o atende ao limite de entrega padr\xE3o, produto de entrega adicionado",O(n))):(d.Shipping_Conditions__c="ZD",l(n),S>=_?(i.message="A cesta excede o limite fora da rota, sem custo",l(u)):(i.message="A cesta n\xE3o atende ao limite fora da rota, produto de entrega adicionado",O(u)))}else i.message="",l(n),l(u);c.orderChanged&&(i.updateDeviceData={Order:!0,OrderItem:!0},i.reprice=!0),b?i.message+=`

Aviso, a data selecionada para entrega \xE9 um feriado ou um fim de semana \u2757`:i.message+=`

Nova data de entrega: ${d.EndDate}`;function z(e){e.ProductCode=="000000019000000031"?D=e.Id:e.ProductCode=="000000019000000034"&&(A=e.Id)}function L(e){e.Pricebook2Id==v&&(e.Product2Id==D?(n=e,P=e["MOV_"+h+"__c"]):e.Product2Id==A&&(u=e,_=e["MOV_"+h+"__c"]))}function w(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==n.Id||e.PricebookEntryId==u.Id)&&(S+=e.UnitPrice*e.Quantity)}function m(e){return new Date(e.setDate(e.getDate()+1))}function I(e){return dateString=e.toISOString().substring(0,10),Object.keys(E).includes(dateString)?E[dateString].some(o=>["All",B.Name].includes(o)):!1}function O(e){let o;for(let y in t)if(t[y].PricebookEntryId==e.Id){o=y;break}o?t[o].Quantity!=1&&(t[o].Quantity=1,c.orderChanged=!0):(t.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),c.orderChanged=!0,c.reprice=!0)}function l(e){let o;for(let y in t)if(t[y].PricebookEntryId==e.Id){o=y;break}o&&(t.splice(o,1),c.orderChanged=!0)}return T}
