function runAction(W){const{data:{record:{Pricebook2Id:v},record:d,related:{Account:[I],OrderItem:o,Product2:b,PricebookEntry:x,aforza__Inventory__c:[Q]}},data:u}=W;let A,P,c,E,_,l;const C={"2023-09-03":["Warehouse - Algoz"],"2023-09-07":["Warehouse - Faro"],"2023-08-15":["Warehouse - Leiria","Warehouse - Alcains","Warehouse - Coimbra","Warehouse - Beja","Warehouse - Gr\xE2ndola","Warehouse - Set\xFAbal","Warehouse - Portalegre","Warehouse - Porto","Warehouse - Odemira","Warehouse - Bombarral","Warehouse - Camarate"],"2023-12-25":["All"],"2023-12-08":["All"],"2023-12-01":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"]};let S=0,n={orderChanged:!1,reprice:!1},s,f=I.Customer_Segment__c;(!f||f=="99")&&(f="06"),b.forEach(z),x.forEach(B),A&&!P&&(P=0),E&&!_&&(_=0),o.forEach(L);let a,i,t,O,k=d.EndDate,y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=I.Delivery_Day__c.split(";");if(k)a=new Date(k),t=y[a.getDay()],(T(a)||["Saturday","Sunday"].includes(t))&&(O=!0);else{for(a=m(new Date),t=y[a.getDay()],i=T(a)||!g.includes(t),i&&g.includes(t)&&(a=m(a),t=y[a.getDay()],i=!1);i;)a=m(a),t=y[a.getDay()],i=T(a)||!g.includes(t),i&&g.includes(t)&&(a=m(a),t=y[a.getDay()],i=!1);d.EndDate=a.toISOString().substring(0,10),n.orderChanged=!0}if(d.Type!="YDEV"&&d.Type!="YBLC"&&d.Type!="YDL1"){var w=g.includes(t)||["PT16","PT17","PT25"].includes(I.Typology__c);w?(d.Shipping_Conditions__c="ZA",D(l),S>=P?(s="A cesta excede o limite de entrega padr\xE3o, sem custo",D(c)):(s="A cesta n\xE3o atende ao limite de entrega padr\xE3o, produto de entrega adicionado",p(c))):(d.Shipping_Conditions__c="ZD",D(c),S>=_?(s="A cesta excede o limite fora da rota, sem custo",D(l)):(s="A cesta n\xE3o atende ao limite fora da rota, produto de entrega adicionado",p(l)))}else u.message="";n.orderChanged&&(u.updateDeviceData={Order:!0,OrderItem:!0},u.reprice=!0),O?u.message=s+`

Aviso, a data selecionada para entrega \xE9 um feriado ou um fim de semana \u2757`:u.message=s+`

Nova data de entrega: ${d.EndDate}`;function z(e){e.ProductCode=="000000019000000031"?A=e.Id:e.ProductCode=="000000019000000034"&&(E=e.Id)}function B(e){e.Pricebook2Id==v&&(e.Product2Id==A?(c=e,P=e["MOV_"+f+"__c"]):e.Product2Id==E&&(l=e,_=e["MOV_"+f+"__c"]))}function L(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==c.Id||e.PricebookEntryId==l.Id)&&(S+=e.UnitPrice*e.Quantity)}function m(e){return new Date(e.setDate(e.getDate()+1))}function T(e){return dateString=e.toISOString().substring(0,10),Object.keys(C).includes(dateString)?C[dateString].some(r=>["All",Q.Name].includes(r)):!1}function p(e){let r;for(let h in o)if(o[h].PricebookEntryId==e.Id){r=h;break}r?o[r].Quantity!=1&&(o[r].Quantity=1,n.orderChanged=!0):(o.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),n.orderChanged=!0,n.reprice=!0)}function D(e){let r;for(let h in o)if(o[h].PricebookEntryId==e.Id){r=h;break}r&&(o.splice(r,1),n.orderChanged=!0)}return W}
