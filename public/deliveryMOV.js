function runAction(S){const{data:{record:{Pricebook2Id:C},record:_,related:{Account:[D],OrderItem:a,Product2:b,PricebookEntry:x,aforza__Inventory__c:[B]}},data:o}=S;let g,u,s,A,c,y;const T={"2023-04-19":["All"],"2023-04-07":["All"],"2023-12-25":["All"],"2023-12-08":["All"],"2023-12-01":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-08-15":["All"],"2023-06-10":["All"],"2023-06-08":["All"],"2023-04-25":["All","Warehouse - Alcains"],"2023-05-01":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"],"2023-05-22":["Warehouse - Leiria"],"2023-06-13":["Warehouse - Camarate"],"2023-05-23":["Warehouse - Portalegre"],"2023-06-24":["Warehouse - Porto"],"2023-06-29":["Warehouse - Set\xFAbal","Warehouse - \xC9vora","Warehouse - Bombarral"],"2023-09-03":["Warehouse - Algoz"],"2023-05-18":["Warehouse - Beja"],"2023-07-04":["Warehouse - Coimbra"],"2023-09-07":["Warehouse - Faro"]};let f=0,n={orderChanged:!1,reprice:!1},i,d=D.Customer_Segment__c;(!d||d=="99")&&(d="06"),b.forEach(Q),x.forEach(R),g&&!u&&(u=0),A&&!c&&(c=0),a.forEach(w);let r,I,l,v,k=_.EndDate,O=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=D.Delivery_Day__c.split(";");if(k)r=new Date(k),l=O[r.getDay()],E(r)||(v=!0);else{for(r=W(new Date),l=O[r.getDay()],I=E(r)&&!["Saturday","Sunday"].includes(l);!I;)r=W(r),l=O[r.getDay()],I=E(r)&&!["Saturday","Sunday"].includes(l);_.EndDate=r.toISOString().substring(0,10)}var V=M.includes(l)||["PT16","PT17","PT25"].includes(D.Typology__c);V?(P(y),f>=u?(i="Basket Exceeds Standard Delivery Threshold, no charge",P(s)):(i="Basket does not meet Standard Delivery Threshold, delivery product added",m(s))):(P(s),f>=c?(i="Basket Exceeds Out Of Route Threshold, no charge",P(y)):(i="Basket does not meet Out Of Route Threshold, delivery product added",m(y))),n.orderChanged?(o.updateDeviceData={Order:!0,OrderItem:!0},o.reprice=n.reprice):(o.updateDeviceData=!1,o.reprice=!1),v?o.error=i+`

Caution: Delivery date on holiday: ${_.EndDate}\u2757
Total: ${f}`:o.message=i+`

Delivery Date: ${_.EndDate}
Total: ${f}`;function Q(e){e.ProductCode=="000000019000000031"?(g=e.Id,u=e["MOV_"+d+"__c"]):e.ProductCode=="000000019000000034"&&(A=e.Id,c=e["MOV_"+d+"__c"])}function R(e){e.Pricebook2Id==C&&(e.Product2Id==g?(s=e,e["MOV_"+d+"__c"]&&(u=e["MOV_"+d+"__c"])):e.Product2Id==A&&(y=e,e["MOV_"+d+"__c"]&&(c=e["MOV_"+d+"__c"])))}function w(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==s.Id||e.PricebookEntryId==y.Id)&&(f+=e.UnitPrice*e.Quantity)}function W(e){return new Date(e.setDate(e.getDate()+1))}function E(e){return dateString=e.toISOString().substring(0,10),Object.keys(T).includes(dateString)?!T[dateString].some(t=>["All",B.Name].includes(t)):!0}function m(e){let t;for(let h in a)if(a[h].PricebookEntryId==e.Id){t=h;break}t?a[t].Quantity!=1&&(a[t].Quantity=1,n.orderChanged=!0):(a.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),n.orderChanged=!0,n.reprice=!0)}function P(e){let t;for(let h in a)if(a[h].PricebookEntryId==e.Id){t=h;break}t&&(a.splice(t,1),n.orderChanged=!0)}return S}
