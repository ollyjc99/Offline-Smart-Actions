function runAction(v){const{data:{record:{Pricebook2Id:V},record:u,related:{Account:[g],OrderItem:a,Product2:B,PricebookEntry:x,aforza__Inventory__c:[Q]}},data:d}=v;if(u.Type!="YDEV"){let C=function(e){e.ProductCode=="000000019000000031"?(D=e.Id,s=e["MOV_"+o+"__c"]):e.ProductCode=="000000019000000034"&&(I=e.Id,f=e["MOV_"+o+"__c"])},b=function(e){e.Pricebook2Id==V&&(e.Product2Id==D?(c=e,e["MOV_"+o+"__c"]&&(s=e["MOV_"+o+"__c"])):e.Product2Id==I&&(y=e,e["MOV_"+o+"__c"]&&(f=e["MOV_"+o+"__c"])))},M=function(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==c.Id||e.PricebookEntryId==y.Id)&&(O+=e.UnitPrice*e.Quantity)},S=function(e){return new Date(e.setDate(e.getDate()+1))},P=function(e){return dateString=e.toISOString().substring(0,10),Object.keys(k).includes(dateString)?!k[dateString].some(t=>["All",Q.Name].includes(t)):!0},T=function(e){let t;for(let _ in a)if(a[_].PricebookEntryId==e.Id){t=_;break}t?a[t].Quantity!=1&&(a[t].Quantity=1,n.orderChanged=!0):(a.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),n.orderChanged=!0,n.reprice=!0)},h=function(e){let t;for(let _ in a)if(a[_].PricebookEntryId==e.Id){t=_;break}t&&(a.splice(t,1),n.orderChanged=!0)};var z=C,N=b,U=M,j=S,p=P,F=T,$=h;let D,s,c,I,f,y;const k={"2023-04-07":["All"],"2023-12-25":["All"],"2023-12-08":["All"],"2023-12-01":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-08-15":["All"],"2023-06-10":["All"],"2023-06-08":["All"],"2023-04-25":["All","Warehouse - Alcains"],"2023-05-01":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"],"2023-05-22":["Warehouse - Leiria"],"2023-06-13":["Warehouse - Camarate"],"2023-05-23":["Warehouse - Portalegre"],"2023-06-24":["Warehouse - Porto"],"2023-06-29":["Warehouse - Set\xFAbal","Warehouse - \xC9vora","Warehouse - Bombarral"],"2023-09-03":["Warehouse - Algoz"],"2023-05-18":["Warehouse - Beja"],"2023-07-04":["Warehouse - Coimbra"],"2023-09-07":["Warehouse - Faro"]};let O=0,n={orderChanged:!1,reprice:!1},i,o=g.Customer_Segment__c;(!o||o=="99")&&(o="06"),B.forEach(C),x.forEach(b),D&&!s&&(s=0),I&&!f&&(f=0),a.forEach(M);let r,A,l,m,W=u.EndDate,E=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],w=g.Delivery_Day__c.split(";");if(W)r=new Date(W),l=E[r.getDay()],P(r)||(m=!0);else{for(r=S(new Date),l=E[r.getDay()],A=P(r)&&!["Saturday","Sunday"].includes(l);!A;)r=S(r),l=E[r.getDay()],A=P(r)&&!["Saturday","Sunday"].includes(l);u.EndDate=r.toISOString().substring(0,10)}var R=w.includes(l)||["PT16","PT17","PT25"].includes(g.Typology__c);R?(h(y),O>=s?(i="Basket Exceeds Standard Delivery Threshold, no charge",h(c)):(i="Basket does not meet Standard Delivery Threshold, delivery product added",T(c))):(h(c),O>=f?(i="Basket Exceeds Out Of Route Threshold, no charge",h(y)):(i="Basket does not meet Out Of Route Threshold, delivery product added",T(y))),n.orderChanged?(d.updateDeviceData={Order:!0,OrderItem:!0},d.reprice=n.reprice):(d.updateDeviceData=!1,d.reprice=!1),m?d.message=i+`

Caution: Delivery date on holiday: ${u.EndDate}\u2757`:d.message=i+`

Delivery Date: ${u.EndDate}`}else d.message="No Minumum Order Value for Devolution order type \u2714";return v}
