function runAction(C){const{data:{record:{Pricebook2Id:p},record:d,related:{Account:[D],OrderItem:o,Product2:b,PricebookEntry:x,aforza__Inventory__c:[Q]}},data:u}=C;let I,P,l,E,_,c;const W={"2023-04-07":["All"],"2023-12-25":["All"],"2023-12-08":["All"],"2023-12-01":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-08-15":["All"],"2023-06-10":["All"],"2023-06-08":["All"],"2023-04-25":["All","Warehouse - Alcains"],"2023-05-01":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"],"2023-05-22":["Warehouse - Leiria"],"2023-06-13":["Warehouse - Camarate"],"2023-05-23":["Warehouse - Portalegre"],"2023-06-24":["Warehouse - Porto"],"2023-06-29":["Warehouse - Set\xFAbal","Warehouse - \xC9vora","Warehouse - Bombarral"],"2023-09-03":["Warehouse - Algoz"],"2023-05-18":["Warehouse - Beja"],"2023-07-04":["Warehouse - Coimbra"],"2023-09-07":["Warehouse - Faro"]};let S=0,n={orderChanged:!1,reprice:!1},s,f=D.Customer_Segment__c;(!f||f=="99")&&(f="06"),b.forEach(z),x.forEach(B),I&&!P&&(P=0),E&&!_&&(_=0),o.forEach(M);let a,i,t,k,v=d.EndDate,y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=D.Delivery_Day__c.split(";");if(v)a=new Date(v),t=y[a.getDay()],(T(a)||["Saturday","Sunday"].includes(t))&&(k=!0);else{for(a=A(new Date),t=y[a.getDay()],i=T(a)||!g.includes(t),i&&g.includes(t)&&(a=A(a),t=y[a.getDay()],i=!1);i;)a=A(a),t=y[a.getDay()],i=T(a)||!g.includes(t),i&&g.includes(t)&&(a=A(a),t=y[a.getDay()],i=!1);d.EndDate=a.toISOString().substring(0,10),n.orderChanged=!0}if(d.Type!="YDEV"&&d.Type!="YBLC"){var w=g.includes(t)||["PT16","PT17","PT25"].includes(D.Typology__c);w?(d.Shipping_Conditions__c="ZA",m(c),S>=P?(s="A cesta excede o limite de entrega padr\xE3o, sem custo",m(l)):(s="A cesta n\xE3o atende ao limite de entrega padr\xE3o, produto de entrega adicionado",O(l))):(d.Shipping_Conditions__c="ZD",m(l),S>=_?(s="A cesta excede o limite fora da rota, sem custo",m(c)):(s="A cesta n\xE3o atende ao limite fora da rota, produto de entrega adicionado",O(c)))}else u.message="";n.orderChanged&&(u.updateDeviceData={Order:!0,OrderItem:!0},u.reprice=!0),k?u.message=s+`

Aviso, a data selecionada para entrega \xE9 um feriado ou um fim de semana \u2757`:u.message=s+`

Nova data de entrega: ${d.EndDate}`;function z(e){e.ProductCode=="000000019000000031"?I=e.Id:e.ProductCode=="000000019000000034"&&(E=e.Id)}function B(e){e.Pricebook2Id==p&&(e.Product2Id==I?(l=e,P=e["MOV_"+f+"__c"]):e.Product2Id==E&&(c=e,_=e["MOV_"+f+"__c"]))}function M(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==l.Id||e.PricebookEntryId==c.Id)&&(S+=e.UnitPrice*e.Quantity)}function A(e){return new Date(e.setDate(e.getDate()+1))}function T(e){return dateString=e.toISOString().substring(0,10),Object.keys(W).includes(dateString)?W[dateString].some(r=>["All",Q.Name].includes(r)):!1}function O(e){let r;for(let h in o)if(o[h].PricebookEntryId==e.Id){r=h;break}r?o[r].Quantity!=1&&(o[r].Quantity=1,n.orderChanged=!0):(o.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),n.orderChanged=!0,n.reprice=!0)}function m(e){let r;for(let h in o)if(o[h].PricebookEntryId==e.Id){r=h;break}r&&(o.splice(r,1),n.orderChanged=!0)}return C}
