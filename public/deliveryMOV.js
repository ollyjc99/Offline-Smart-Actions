function runAction(T){const{data:{record:{Pricebook2Id:b},record:d,related:{Account:[P],OrderItem:r,Product2:p,PricebookEntry:x,aforza__Inventory__c:[Q]}},data:u}=T;let _,y,s,A,g,l;const W={"2023-04-07":["All"],"2023-12-25":["All"],"2023-12-08":["All"],"2023-12-01":["All"],"2023-11-01":["All"],"2023-10-05":["All"],"2023-08-15":["All"],"2023-06-10":["All"],"2023-06-08":["All"],"2023-04-25":["All","Warehouse - Alcains"],"2023-05-01":["All"],"2023-10-22":["Warehouse - Gr\xE2ndola"],"2023-05-22":["Warehouse - Leiria"],"2023-06-13":["Warehouse - Camarate"],"2023-05-23":["Warehouse - Portalegre"],"2023-06-24":["Warehouse - Porto"],"2023-06-29":["Warehouse - Set\xFAbal","Warehouse - \xC9vora","Warehouse - Bombarral"],"2023-09-03":["Warehouse - Algoz"],"2023-05-18":["Warehouse - Beja"],"2023-07-04":["Warehouse - Coimbra"],"2023-09-07":["Warehouse - Faro"]};let m=0,n={orderChanged:!1,reprice:!1},i,c=P.Customer_Segment__c;(!c||c=="99")&&(c="06"),p.forEach(z),x.forEach(B),_&&!y&&(y=0),A&&!g&&(g=0),r.forEach(M);let t,D,o,C,k=d.EndDate,I=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],E=P.Delivery_Day__c.split(";");if(k)t=new Date(k),o=I[t.getDay()],(!S(t)||["Saturday","Sunday"].includes(o))&&(C=!0);else{for(t=v(new Date),o=I[t.getDay()],D=S(t)&&E.includes(o);!D;)t=v(t),o=I[t.getDay()],D=S(t)&&E.includes(o);d.EndDate=t.toISOString().substring(0,10),n.orderChanged=!0}if(d.Type!="YDEV"){var w=E.includes(o)||["PT16","PT17","PT25"].includes(P.Typology__c);w?(d.Shipping_Conditions__c="ZA",h(l),m>=y?(i="A cesta excede o limite de entrega padr\xE3o, sem custo",h(s)):(i="A cesta n\xE3o atende ao limite de entrega padr\xE3o, produto de entrega adicionado",O(s))):(d.Shipping_Conditions__c="ZD",h(s),m>=g?(i="A cesta excede o limite fora da rota, sem custo",h(l)):(i="A cesta n\xE3o atende ao limite fora da rota, produto de entrega adicionado",O(l)))}else u.message="";n.orderChanged&&(u.updateDeviceData={Order:!0,OrderItem:!0},u.reprice=!0),C?u.message=i+`

Aviso, a data selecionada para entrega \xE9 um feriado ou um fim de semana \u2757`:u.message=i+`

Nova data de entrega: ${d.EndDate}`;function z(e){e.ProductCode=="000000019000000031"?_=e.Id:e.ProductCode=="000000019000000034"&&(A=e.Id)}function B(e){e.Pricebook2Id==b&&(e.Product2Id==_?(s=e,y=e["MOV_"+c+"__c"]):e.Product2Id==A&&(l=e,g=e["MOV_"+c+"__c"]))}function M(e){e.Quantity&&e.UnitPrice&&e.aforza__Type__c!="Tax"&&!(e.PricebookEntryId==s.Id||e.PricebookEntryId==l.Id)&&(m+=e.UnitPrice*e.Quantity)}function v(e){return new Date(e.setDate(e.getDate()+1))}function S(e){return dateString=e.toISOString().substring(0,10),Object.keys(W).includes(dateString)?!W[dateString].some(a=>["All",Q.Name].includes(a)):!0}function O(e){let a;for(let f in r)if(r[f].PricebookEntryId==e.Id){a=f;break}a?r[a].Quantity!=1&&(r[a].Quantity=1,n.orderChanged=!0):(r.push({Product2Id:e.Product2Id,PricebookEntryId:e.Id,Quantity:1,UnitPrice:0,aforza__Type__c:"Product"}),n.orderChanged=!0,n.reprice=!0)}function h(e){let a;for(let f in r)if(r[f].PricebookEntryId==e.Id){a=f;break}a&&(r.splice(a,1),n.orderChanged=!0)}return T}
